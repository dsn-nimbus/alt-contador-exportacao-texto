!function(o){"use strict";o.module("alt.contador.exportacao-texto",[]).factory("AltContadorExportacaoTextoModel",[function(){var o=function(o,e,t,r,a){this.separador=a||";",this.propriedades=o||[],this.propriedadesCentroDeCusto=e||[],this.info=t||[],this.arquivoContabil=r||!1};return o}]).factory("AltContadorExportacaoTextoParser",["AltContadorExportacaoTextoModel",function(e){var t=function(o){return o instanceof e?void(this.expModelo=o):this.expModelo=new e};return t.prototype.parseArquivo=function(){var e=[],t=this.expModelo.propriedades,r=this.expModelo.propriedadesCentroDeCusto,a=this.expModelo.info,n=this.expModelo.separador,i=!!this.expModelo.arquivoContabil,c=[],p=/\d+\.\d{1,2}/,u=/\d/,d="%0A",l="%20",s="centrosDeCusto";return o.forEach(a,function(a){var n=[],c=!!a[s];o.forEach(t,function(e){if(o.isDefined(a[e])){var t=a[e];""===t?t='""':i?(t='"'+t+'"',p.test(t)&&/valor/.test(e)&&(t='"'+p.exec(t).join().replace(".",",").replace(/\n/gi,"").replace(/\u21b5/g,"")+'"')):t=u.test(t)?'"'+String(t).replace(".",",").replace(/\n/gi,"").replace(/\u21b5/g,"")+'"':'"'+t.replace(/\n/gi,"").replace(/\u21b5/g,"")+'"',n.push(t)}}),e.push(n),c&&o.forEach(a[s],function(t){var a=[];o.forEach(r,function(e){if(o.isDefined(t[e])){var r=t[e];""===r?r='""':i?(r='"'+r+'"',p.test(r)&&/valor/.test(e)&&(r='"'+p.exec(r).join().replace(".",",").replace(/\n/gi,"")+'"')):r=u.test(r)?'"'+String(r).replace(".",",").replace(/\n/gi,"").replace(/\u21b5/g,"")+'"':'"'+r.replace(/\n/gi,"").replace(/\u21b5/g,"")+'"',a.push(r)}}),e.push(a)})}),o.forEach(e,function(o,e){c.push(o.join(n))}),c.join(d).replace(/ /g,l)},t}]).factory("AltContadorExportacaoTextoExec",[function(){var o=function(o){this.document=o};return o.prototype.exporta=function(o,e,t){var r=this.document.createElement("a");r.href="data:attachment/"+t+";charset=utf-8,%EF%BB%BF"+o,r.target="_blank",r.download=e,this.document.body.appendChild(r),r.click(),this.document.body.removeChild(r)},o}]).directive("altContadorExportacaoTexto",["AltContadorExportacaoTextoModel","AltContadorExportacaoTextoParser","AltContadorExportacaoTextoExec",function(o,e,t){return{restrict:"A",link:function(r,a,n){var i=null,c=null,p=new t(document);a.on("click",function(){var t=r.tipoArquivo||"csv",a=r.nomeArquivo||"Exportação",n=r.preparaInfo();c=new o(n.propriedades,n.info,r.arquivoContabil,r.separador),i=new e(c),p.exporta(i.parseArquivo(),a,t)})},scope:{nomeArquivo:"@",tipoArquivo:"@",arquivoContabil:"@",separador:"@",preparaInfo:"&"}}}])}(window.angular);